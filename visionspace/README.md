# Vision


## Установка


### Frontend

Frontend написан на React с использованием TypeScipt и Vite. Необходимо установить NodeJS и установщик пакетов или npm, или yarn или др.
Открываем command terminal переходим по иерархии папок в директорию frontend и пишем `npm i` (сокр. от `npm install`). Данная команда установит необходимые зависимости и пакеты.  
После установки всех необходимых компонентов, запустить локальный сервер можно командой `npm run dev`.
Для "сборки" сайта необходимо написать `npm run build`, данная команда соберёт сайт в папке dist в директории frontend, содержимое dist можно выкладывать на сервер.


### Backend

Для запуска Backend-а необходим установленный и насттроенный сервер Postgres, либо другую СУБД (MySql, Sqlite3, Mongo). После установки СУБД, необходимо создать пустую базу данных, например, vision.
На следующем этапе необходимо создать в директории (backend/vision) файл настроек dotenv - `.env`, скопировать файл .env.example и заполнить все данные, которые там присутствуют: credentionals для подключения к базе данных, настройки работы JWT-токенов, настройка подключения к KeyCloak (если он будет использоваться), подключение к серверу SMTP для рассылки почтовых уведомлений. После настройки .env необходимо создать venv на python 3.11.X (python3.11 -m venv venv), активировать venv (source venv/bin/active (также зависит от ОС сервера, команда активации может различаться)) и установить зависимости приложения (pip install -r requirements.txt), провести все миграции приложения (python manage.py makemigrations), после чего перенести все миграции в созданную базу данных (python manage.py migrate), далее собрать статические файлы панели администрирования Django (python manage.py collectstatic). После выполнения данных пунктов можно запустить приложение командой (python manage.py runserver).
Для сборки на сервере провести похожие пункты, до запуска локально. Вместо локального запуска необходима настройка Nginx и Gunicorn для запуска на сервере.
Настройка Nginx находится в папке (visionspace/nginx/default.conf), для Gunicorn приложения необходимо создать службу, работающую от имени пользователя самого сервера (лучше будет, если для приложения будет собственный пользователь), также указать группу приложения - "www-data", указать папку установленного gunicorn (ссылку на Gunicorn из venv папки, адрес: venv/bin/gunicorn). После настройки службы Gunicorn необходимо создать символическую ссылку на службу командой (systemctl enable путь_до_службы), а после чего запустить (systemctl start путь_до_службы)


### Nginx

Базовая конфигурация настроек для nginx уже прописана в готовом конфиге, его необходимо закинуть на сервер, после чего сайт будет работать в соответствии с конфигурацией:  
frontend будет доступен по адресу https://vision.api-factory.ru/  
backend будет доступен по адресу https://vision.api-factory.ru/api/*

Также важно наличие https на сервере, иначе не будет работать сохранение токена доступа (Access), в связи с чем не будет правильно отрабатывать авторизация приложения.